# SVN/Git 自动提交 VSCode 插件需求规格说明书

## 1. 产品概述

本插件旨在为 VSCode 用户提供便捷的版本控制提交功能，支持 SVN 和 Git 两种主流版本控制系统，通过简单的配置和操作，实现代码的快速提交，提高开发效率。

## 2. 功能需求

### 2.1 核心功能

- **多版本控制系统支持**：支持 SVN 和 Git 两种主流版本控制系统
- **自动提交**：根据配置自动生成提交信息并提交代码
- **快捷键支持**：通过自定义快捷键快速触发提交操作
- **提交信息模板**：支持自定义提交信息模板，满足不同项目的规范要求
- **批量操作**：支持选择性提交或批量提交多个文件
- **提交历史**：查看和管理提交历史记录
- **冲突解决**：提供简单的冲突解决辅助功能

### 2.2 版本控制系统支持

#### 2.2.1 SVN 支持
- **兼容版本**：支持 SVN 1.7 及以上版本
- **基本操作**：
  - 更新（Update）
  - 提交（Commit）
  - 添加（Add）
  - 删除（Delete）
  - 还原（Revert）
  - 查看日志（Log）
- **高级功能**：
  - 分支管理
  - 标签管理
  - 锁定/解锁文件
  - 合并操作辅助

#### 2.2.2 Git 支持
- **兼容版本**：支持 Git 2.0 及以上版本
- **基本操作**：
  - 拉取（Pull）
  - 推送（Push）
  - 提交（Commit）
  - 添加（Add）
  - 还原（Reset）
  - 查看日志（Log）
- **高级功能**：
  - 分支管理
  - 标签管理
  - 暂存操作
  - 变基（Rebase）辅助

### 2.3 版本控制系统配置

#### 2.3.1 SVN 配置
- 自动检测项目 SVN 仓库信息
- 支持配置 SVN 用户名和密码
- 支持配置 SVN 提交相关参数
- 支持 SVN 忽略文件配置
- 支持自定义 SVN 命令路径

#### 2.3.2 Git 配置
- 自动检测项目 Git 仓库信息
- 支持配置 Git 用户信息
- 支持配置 Git 提交相关参数
- 支持 .gitignore 文件管理
- 支持自定义 Git 命令路径

## 3. 安装说明

### 3.1 安装方式
1. 通过 VSCode 插件市场搜索"SVN/Git 自动提交"插件
2. 点击安装按钮完成安装
3. 重启 VSCode 使插件生效

## 4. 使用指南

### 4.1 基础配置
- 插件会自动检测项目的版本控制系统类型（SVN/Git）
- 用户可在项目设置中配置版本控制系统的用户名和密码
- 支持全局配置和项目级配置，项目级配置优先级更高

### 4.2 提交操作
- 通过 VSCode 命令面板执行提交命令
- 通过自定义快捷键触发提交操作（默认：Ctrl+Alt+C）
- 支持右键菜单中的提交选项
- 支持状态栏快速操作按钮

### 4.3 用户界面

#### 4.3.1 主要界面组件

1. **状态栏组件**
   - 显示当前版本控制系统类型（SVN/Git）
   - 显示当前分支/版本信息
   - 提供快速操作按钮（提交、更新/拉取、查看历史）
   - 显示自动提交状态和倒计时（如已启用）

2. **提交对话框**
   - 变更文件列表，支持多选和文件预览
   - 提交信息输入区，支持模板选择和历史记录
   - 提交类型选择下拉菜单
   - 提交选项（如：添加未版本化文件、忽略外部定义等）
   - 操作按钮（提交、取消、保存为草稿）

3. **设置界面**
   - 全局设置页面
   - 项目特定设置页面
   - 提交模板编辑器
   - 快捷键配置区域

4. **历史记录查看器**
   - 提交历史时间线
   - 提交详情查看面板
   - 文件差异比较器
   - 版本回退操作区

#### 4.3.2 界面设计原则

- 遵循 VSCode 界面设计规范
- 简洁直观，减少操作步骤
- 提供足够的视觉反馈
- 支持键盘操作和快捷键
- 适配浅色和深色主题
- 支持国际化和本地化

### 4.4 交互流程

#### 4.4.1 基本提交流程

1. 用户触发提交操作（快捷键、命令面板或右键菜单）
2. 插件检查工作区变更
3. 显示提交对话框，包含变更文件列表和提交信息输入区
4. 用户选择要提交的文件，输入或确认提交信息
5. 点击"提交"按钮执行提交操作
6. 显示提交结果通知

#### 4.4.2 自动提交流程

1. 用户启用自动提交功能并设置时间间隔
2. 插件定期检查工作区变更
3. 当检测到变更且满足自动提交条件时，生成提交信息
4. 根据配置决定是否显示确认对话框
5. 执行提交操作
6. 显示提交结果通知

#### 4.4.3 冲突解决流程

1. 插件检测到文件冲突
2. 显示冲突通知，提供解决选项
3. 用户选择解决方式（保留本地版本、使用远程版本、手动合并）
4. 对于手动合并，打开内置的差异比较器
5. 用户完成合并后，标记冲突为已解决
6. 继续提交流程

## 5. 配置选项详解

### 5.1 全局配置

插件支持以下全局配置选项：

| 配置项 | 说明 | 默认值 |
|-------|------|-------|
| `svn-auto-commit.enabled` | 是否启用插件 | `true` |
| `svn-auto-commit.defaultVCS` | 默认版本控制系统 | `"auto"` |
| `svn-auto-commit.autoDetect` | 是否自动检测版本控制系统 | `true` |
| `svn-auto-commit.commitShortcut` | 提交快捷键 | `"ctrl+alt+c"` |
| `svn-auto-commit.showStatusBar` | 是否在状态栏显示插件状态 | `true` |
| `svn-auto-commit.confirmBeforeCommit` | 提交前是否确认 | `true` |

### 5.2 SVN 特定配置

| 配置项 | 说明 | 默认值 |
|-------|------|-------|
| `svn-auto-commit.svn.path` | SVN 命令路径 | `"svn"` |
| `svn-auto-commit.svn.username` | SVN 用户名 | `""` |
| `svn-auto-commit.svn.password` | SVN 密码（加密存储） | `""` |
| `svn-auto-commit.svn.autoUpdate` | 提交前是否自动更新 | `true` |
| `svn-auto-commit.svn.addUnversioned` | 是否自动添加未版本化文件 | `false` |
| `svn-auto-commit.svn.ignoreExternals` | 是否忽略外部定义 | `true` |

### 5.3 Git 特定配置

| 配置项 | 说明 | 默认值 |
|-------|------|-------|
| `svn-auto-commit.git.path` | Git 命令路径 | `"git"` |
| `svn-auto-commit.git.username` | Git 用户名 | `""` |
| `svn-auto-commit.git.email` | Git 邮箱 | `""` |
| `svn-auto-commit.git.autoPull` | 提交前是否自动拉取 | `true` |
| `svn-auto-commit.git.autoPush` | 提交后是否自动推送 | `false` |
| `svn-auto-commit.git.addAll` | 是否自动添加所有变更 | `false` |

### 5.4 项目级配置

插件支持通过项目根目录下的 `.svn-auto-commit.json` 文件进行项目级配置，覆盖全局配置：

```json
{
  "vcs": "svn",
  "username": "project-username",
  "password": "encrypted-password",
  "commitTemplate": "[{type}] {message} - {author} ({date})",
  "commitTypes": ["feat", "fix", "docs", "style", "refactor", "test", "chore"],
  "defaultCommitType": "fix",
  "defaultAuthor": "Team Name",
  "autoCommitEnabled": true,
  "autoCommitInterval": 30,
  "ignorePatterns": ["*.log", "node_modules/", "dist/"],
  "hooks": {
    "preCommit": "npm run lint",
    "postCommit": "npm run build"
  }
}
```

## 6. 提交信息配置

### 6.1 提交信息生成方式

插件支持三种提交信息生成方式：

- **手动输入**：每次提交时手动输入提交信息
  - 可配置是否显示提交信息输入框
  - 可配置提交信息输入框的默认值
  - 可配置提交信息的最小长度要求

- **自动生成**：根据预设模板自动生成提交信息
  - 可配置是否使用项目级模板
  - 可配置是否包含变更文件信息
  - 可配置是否包含提交统计信息（如新增/修改/删除的行数）

- **混合模式**：基于模板生成基础信息，允许用户补充修改
  - 可配置哪些字段允许用户修改
  - 可配置哪些字段为必填项
  - 可配置字段的默认值和验证规则

### 6.2 提交信息模板配置

提交信息可包含以下元素，用户可自定义组合方式：

1. **提交类型**
   - 预设选项：新增、修改、删除、重构、修复、文档、测试、其他
   - 支持项目自定义类型列表
   - 支持手动输入自定义类型
   - 支持为不同类型设置不同颜色标识
   - 支持为不同类型设置不同的提交前检查规则

2. **提交内容**
   - 支持自动包含变更文件列表
   - 支持按文件夹分组展示变更
   - 支持手动编辑变更内容描述
   - 支持智能提取变更内容摘要
   - 支持设置内容描述的最大长度

3. **提交人信息**
   - 支持使用版本控制系统账号作为提交人
   - 支持使用项目配置的固定提交人
   - 支持使用当前系统登录用户作为提交人
   - 支持自定义提交人格式（如：姓名+部门）
   - 支持从预定义的团队成员列表中选择

4. **提交时间**
   - 支持使用当前系统时间
   - 支持使用版本控制系统记录的时间
   - 支持自定义时间格式
   - 支持自动转换为指定时区
   - 支持使用相对时间表示（如：5分钟前）

5. **提交备注**
   - 支持项目预设的固定备注内容
   - 支持手动输入自定义备注
   - 支持备注模板，如任务编号、关联问题等
   - 支持从预定义的备注列表中选择
   - 支持多行备注格式

### 6.3 提交信息模板变量

模板中可使用以下变量：

| 变量 | 说明 | 示例 |
|-----|------|------|
| `{type}` | 提交类型 | "fix" |
| `{message}` | 提交内容描述 | "修复首页加载问题" |
| `{author}` | 提交人 | "张三" |
| `{email}` | 提交人邮箱 | "zhangsan@example.com" |
| `{date}` | 提交日期 | "2023-06-01" |
| `{time}` | 提交时间 | "14:30:45" |
| `{datetime}` | 提交日期和时间 | "2023-06-01 14:30:45" |
| `{branch}` | 当前分支名称 | "feature/login" |
| `{files}` | 变更文件列表 | "index.js, style.css" |
| `{fileCount}` | 变更文件数量 | "2" |
| `{ticket}` | 关联的任务票号 | "TASK-1234" |
| `{project}` | 项目名称 | "MyProject" |

### 6.4 提交信息格式示例

#### 基本格式

```
[{type}] {message} - {author} ({datetime})
备注：{notes}
```

#### 实际示例

```
[修复] 修复首页加载缓慢问题 - 张三 (2023-06-01 14:30)
备注：关联任务 #1234
```

#### 带文件列表的格式

```
[{type}] {message} - {author} ({date})

变更文件：
{files}

备注：{notes}
```

#### 实际示例

```
[新增] 添加用户注册功能 - 李四 (2023-06-02)

变更文件：
- src/components/Register.js
- src/styles/register.css
- src/api/user.js

备注：完成注册页面的基本功能，待添加验证码功能
```

#### 符合 Angular 规范的格式

```
{type}({scope}): {message}

{body}

{footer}
```

#### 实际示例

```
feat(auth): implement user registration

Add registration form with email validation and password strength check

Closes #1234
```

## 7. 技术实现要点

### 7.1 架构设计

#### 7.1.1 核心模块

- **命令处理模块**：负责注册和处理 VSCode 命令
- **版本控制适配器**：提供统一的接口封装不同版本控制系统的操作
- **配置管理模块**：处理全局和项目级配置的读取与保存
- **UI 渲染模块**：负责各类界面组件的渲染
- **提交信息生成器**：根据模板和上下文生成提交信息
- **自动提交调度器**：管理自动提交的定时任务

#### 7.1.2 扩展点

- **版本控制系统扩展**：支持通过插件扩展添加其他版本控制系统
- **提交模板扩展**：支持自定义提交信息模板
- **钩子扩展**：支持在提交前后执行自定义脚本

### 7.2 关键技术

- **VSCode 扩展 API**：利用 VSCode 提供的扩展 API 实现插件功能
- **命令行调用**：通过子进程调用 SVN/Git 命令行工具
- **文件系统监控**：监控工作区文件变化
- **WebView**：使用 WebView 实现复杂的用户界面
- **状态持久化**：使用 VSCode 提供的存储 API 保存插件状态
- **安全凭证管理**：使用系统凭证管理器安全存储用户名和密码

### 7.3 性能优化

- **增量更新**：只处理变更的文件，避免全量扫描
- **命令执行优化**：合并多个命令，减少命令行调用次数
- **缓存机制**：缓存常用数据，减少重复计算
- **延迟加载**：按需加载模块，减少启动时间
- **异步处理**：使用异步操作避免阻塞 UI 线程

## 8. 注意事项与限制

### 8.1 安全性考虑

- **凭证安全**：用户名和密码必须加密存储
- **权限控制**：插件应遵循最小权限原则
- **敏感信息处理**：避免在日志中记录敏感信息
- **命令注入防护**：对用户输入进行严格验证，防止命令注入攻击

### 8.2 兼容性考虑

- **VSCode 版本兼容**：支持 VSCode 1.60.0 及以上版本
- **操作系统兼容**：支持 Windows、macOS 和 Linux
- **版本控制工具兼容**：明确支持的 SVN 和 Git 版本范围
- **大型项目支持**：针对大型项目进行性能优化

### 8.3 已知限制

- **离线模式限制**：在网络不可用时，部分功能可能受限
- **大文件处理**：对于超大文件的提交可能需要特殊处理
- **复杂合并冲突**：复杂的合并冲突可能需要用户使用外部工具解决
- **自定义工作流**：可能与某些特定的团队工作流程不完全兼容

### 8.4 未来扩展计划

- **支持更多版本控制系统**：如 Mercurial、Perforce 等
- **团队协作功能**：添加团队成员间的协作功能
- **代码审查集成**：与代码审查系统集成
- **CI/CD 集成**：与持续集成/持续部署系统集成
- **高级统计分析**：提供提交历史的统计和分析功能