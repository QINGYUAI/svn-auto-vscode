# SVN/Git 自动提交插件 - 故障排除指南

## 🔍 诊断工具

### 1. 检查插件状态
- 打开 VSCode 命令面板 (`Ctrl+Shift+P`)
- 输入 `Developer: Reload Window` 重新加载窗口
- 检查状态栏是否显示插件图标

### 2. 查看日志信息
- 打开 VSCode 输出面板 (`Ctrl+Shift+U`)
- 选择 `SVN/Git 自动提交` 输出通道
- 查看详细的错误信息和调试日志

### 3. 检查配置
```bash
# 在 VSCode 设置中搜索
svn-auto-commit
```

## 🚨 常见问题及解决方案

### 问题 1: 插件无法启动

**症状**：
- 状态栏没有显示插件图标
- 命令面板中找不到相关命令

**可能原因**：
- 插件未正确安装
- VSCode 版本不兼容
- 插件被禁用

**解决方案**：
```bash
# 1. 重新编译插件
npm run compile

# 2. 检查编译是否成功
ls -la dist/

# 3. 重启 VSCode 调试模式
# 按 F5 或使用命令面板 "Debug: Start Debugging"
```

### 问题 2: SVN提交失败 - ignore-externals选项错误

**症状**：
```
SVN提交失败: Subcommand 'commit' doesn't accept option '--ignore-externals'
Type 'svn help commit' for usage.
```

**原因**：
- `--ignore-externals` 选项不适用于 `svn commit` 命令
- 该选项应该用于 `svn update` 命令

**解决方案**：
1. **自动修复**：插件已修复此问题，更新到最新版本即可
2. **手动检查配置**：
   ```json
   {
     "svn-auto-commit.svn.ignoreExternals": true
   }
   ```
   此配置现在只会影响 `svn update` 命令，不会影响 `svn commit`

### 问题 3: SVN认证失败

**症状**：
```
SVN更新失败: svn: E170013: Unable to connect to a repository at URL 'svn://8.140.171.106:15518/lwxt'
svn: E170001: Can't get username or password
```

**原因**：
- SVN服务器需要用户名和密码认证
- 插件未配置或未正确存储认证信息

**解决方案**：

1. **使用插件内置认证设置**：
   - 打开命令面板 (`Ctrl+Shift+P`)
   - 输入 `SVN/Git 自动提交: 设置SVN认证`
   - 按提示输入用户名和密码

2. **通过主菜单设置**：
   - 点击状态栏的SVN图标
   - 选择 `设置SVN认证`
   - 输入认证信息

3. **手动配置**：
   ```json
   {
     "svn-auto-commit.svn.username": "your_username"
   }
   ```
   密码会安全存储在系统凭证管理器中

4. **验证认证**：
   ```bash
   # 在终端中测试SVN连接
   svn info svn://8.140.171.106:15518/lwxt --username your_username
   ```

### 问题 4: 无法检测版本控制系统

**症状**：
- 状态栏显示 "未检测到版本控制"
- 无法执行提交操作

**诊断步骤**：
```bash
# 检查项目根目录
ls -la | grep -E "\.(git|svn)"

# 检查 Git 状态
git status

# 检查 SVN 状态  
svn status
```

**解决方案**：
1. **确保项目已初始化版本控制**：
   ```bash
   # Git 项目
   git init
   
   # SVN 项目
   svn checkout <repository-url> .
   ```

2. **手动设置版本控制系统**：
   ```json
   {
     "svn-auto-commit.defaultVCS": "git",  // 或 "svn"
     "svn-auto-commit.autoDetect": false
   }
   ```

### 问题 3: SVN/Git 命令不可用

**症状**：
- 提示 "SVN命令不可用" 或 "Git命令不可用"
- 执行操作时出现命令错误

**诊断步骤**：
```bash
# 检查命令是否存在
which svn
which git

# 检查版本
svn --version
git --version

# 检查 PATH 环境变量
echo $PATH
```

**解决方案**：
1. **安装缺失的工具**：
   ```bash
   # macOS
   brew install git
   brew install subversion
   
   # Ubuntu/Debian
   sudo apt-get install git subversion
   
   # CentOS/RHEL
   sudo yum install git subversion
   ```

2. **设置正确的命令路径**：
   ```json
   {
     "svn-auto-commit.svn.path": "/usr/local/bin/svn",
     "svn-auto-commit.git.path": "/usr/local/bin/git"
   }
   ```

### 问题 4: 认证失败

**症状**：
- 提交时提示用户名或密码错误
- SVN 操作需要重复输入密码

**解决方案**：
1. **配置用户凭证**：
   ```json
   {
     "svn-auto-commit.svn.username": "your_username",
     "svn-auto-commit.svn.password": "your_password",
     "svn-auto-commit.git.username": "your_username",
     "svn-auto-commit.git.email": "your@email.com"
   }
   ```

2. **使用系统凭证管理器**：
   - 插件会自动将密码加密存储在系统凭证管理器中
   - 首次输入后会自动保存

3. **Git SSH 密钥配置**：
   ```bash
   # 生成 SSH 密钥
   ssh-keygen -t rsa -b 4096 -C "your@email.com"
   
   # 添加到 SSH 代理
   ssh-add ~/.ssh/id_rsa
   
   # 将公钥添加到 Git 服务器
   cat ~/.ssh/id_rsa.pub
   ```

### 问题 5: 提交失败

**症状**：
- 提交操作执行后显示失败
- 文件没有被正确提交

**诊断步骤**：
```bash
# 检查工作区状态
git status
svn status

# 检查是否有冲突
git diff
svn diff

# 检查网络连接
ping github.com
ping your-svn-server.com
```

**解决方案**：
1. **解决文件冲突**：
   - 使用插件的冲突解决功能
   - 或手动解决冲突后重新提交

2. **检查文件权限**：
   ```bash
   # 检查文件权限
   ls -la
   
   # 修复权限问题
   chmod 644 filename
   ```

3. **清理工作区**：
   ```bash
   # Git
   git clean -fd
   git reset --hard HEAD
   
   # SVN
   svn cleanup
   svn revert -R .
   ```

### 问题 6: 自动提交不工作

**症状**：
- 启用自动提交但没有自动执行
- 文件修改后没有触发提交

**诊断步骤**：
1. **检查配置**：
   ```json
   {
     "svn-auto-commit.autoCommit.enabled": true,
     "svn-auto-commit.autoCommit.delay": 30
   }
   ```

2. **检查忽略模式**：
   ```json
   {
     "svn-auto-commit.autoCommit.ignorePatterns": [
       "**/.git/**",
       "**/node_modules/**"
     ]
   }
   ```

**解决方案**：
1. **调整延迟时间**：
   - 设置合理的延迟时间（建议 30-60 秒）
   - 避免设置过短的延迟时间

2. **检查文件监控**：
   - 确认修改的文件不在忽略列表中
   - 检查文件路径是否正确

### 问题 7: 性能问题

**症状**：
- VSCode 响应缓慢
- 插件操作耗时过长

**解决方案**：
1. **优化忽略模式**：
   ```json
   {
     "svn-auto-commit.autoCommit.ignorePatterns": [
       "**/node_modules/**",
       "**/dist/**",
       "**/build/**",
       "**/.git/**",
       "**/.svn/**"
     ]
   }
   ```

2. **调整自动提交设置**：
   ```json
   {
     "svn-auto-commit.autoCommit.delay": 60,
     "svn-auto-commit.autoCommit.enabled": false
   }
   ```

3. **禁用不必要的功能**：
   ```json
   {
     "svn-auto-commit.statusBar.enabled": false,
     "svn-auto-commit.autoCommit.showNotification": false
   }
   ```

## 🛠️ 高级故障排除

### 1. 重置插件配置

```json
{
  "svn-auto-commit.enabled": true,
  "svn-auto-commit.defaultVCS": "auto",
  "svn-auto-commit.autoDetect": true,
  "svn-auto-commit.showStatusBar": true,
  "svn-auto-commit.confirmBeforeCommit": true
}
```

### 2. 清理插件数据

```bash
# 删除编译文件
rm -rf dist/

# 重新安装依赖
rm -rf node_modules/
npm install

# 重新编译
npm run compile
```

### 3. 调试模式

1. 在 VSCode 中打开项目
2. 按 `F5` 启动调试模式
3. 在新窗口中测试插件功能
4. 查看调试控制台的输出信息

### 4. 日志收集

```bash
# 启用详细日志
export DEBUG=svn-auto-commit:*

# 运行 VSCode
code .
```

## 📞 获取帮助

### 1. 收集诊断信息

在报告问题时，请提供以下信息：

```bash
# 系统信息
uname -a

# VSCode 版本
code --version

# Node.js 版本
node --version
npm --version

# Git/SVN 版本
git --version
svn --version

# 插件版本
# 在 package.json 中查看
```

### 2. 错误日志

- VSCode 输出面板的完整错误信息
- 终端中的错误输出
- 系统日志相关信息

### 3. 配置信息

- VSCode 设置中的插件配置
- 项目级配置文件内容
- 环境变量设置

## 🔄 常见修复流程

### 完全重置流程

```bash
# 1. 停止 VSCode
# 2. 清理项目
rm -rf dist/ node_modules/

# 3. 重新安装
npm install

# 4. 重新编译
npm run compile

# 5. 重置配置
# 在 VSCode 设置中删除所有 svn-auto-commit 相关配置

# 6. 重启 VSCode 并重新配置
```

### 快速诊断命令

```bash
# 一键诊断脚本
echo "=== 系统信息 ==="
uname -a
echo "=== VSCode 版本 ==="
code --version
echo "=== Git 状态 ==="
git --version && git status
echo "=== SVN 状态 ==="
svn --version && svn status
echo "=== 项目文件 ==="
ls -la | grep -E "\.(git|svn)"
echo "=== 插件文件 ==="
ls -la dist/
```

---

**提示**: 如果以上方法都无法解决问题，请提交详细的错误报告到项目仓库，包含完整的错误日志和系统信息。
