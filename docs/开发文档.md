# SVN/Git 自动提交插件 - 开发文档

## 📖 目录
- [中文化实现](#中文化实现)
- [菜单系统集成](#菜单系统集成)
- [技术架构](#技术架构)
- [开发指南](#开发指南)
- [贡献指南](#贡献指南)

## 🌏 中文化实现

### 🎯 中文化完成情况

#### ✅ 已完成的中文化内容

##### 1. **用户界面文本**
- ✅ 所有用户提示信息（错误、警告、信息提示）
- ✅ 状态栏工具提示文本
- ✅ 命令面板命令标题
- ✅ 快速选择菜单选项
- ✅ 输入框提示文本

##### 2. **配置界面**
- ✅ 插件设置页面的所有配置项描述
- ✅ 配置项的详细说明文本
- ✅ 枚举选项的说明

##### 3. **命令系统**
- ✅ 所有命令的标题和分类
- ✅ 命令的工具提示文本
- ✅ 快捷键绑定说明

##### 4. **日志和调试信息**
- ✅ 控制台输出信息
- ✅ 错误日志信息
- ✅ 调试信息

##### 5. **文档系统**
- ✅ 完整的中文使用文档
- ✅ 快速入门指南
- ✅ 故障排除指南
- ✅ 配置示例和说明

### 📋 具体修改内容

#### 1. 用户提示信息
```typescript
// 示例：错误提示
vscode.window.showErrorMessage('未检测到支持的版本控制系统');
vscode.window.showErrorMessage(`提交失败: ${error}`);
vscode.window.showErrorMessage(`更新失败: ${error}`);

// 示例：信息提示
vscode.window.showInformationMessage('SVN提交成功');
vscode.window.showInformationMessage('Git拉取成功');
vscode.window.showInformationMessage('已启用自动提交功能');

// 示例：输入框提示
const message = await vscode.window.showInputBox({
  prompt: '请输入提交信息',
  value: defaultMessage,
  validateInput: (value) => this.validateMessage(value)
});
```

#### 2. 快速选择菜单
```typescript
// 操作菜单
const items: vscode.QuickPickItem[] = [
  { label: '$(git-commit) 提交更改', description: '提交当前更改' },
  { label: '$(sync) 更新/拉取', description: '从远程仓库更新' },
  { label: '$(history) 查看历史记录', description: '查看版本历史' },
  { label: '$(gear) 打开设置', description: '配置插件设置' }
];

// 冲突解决选项
const options = [
  { label: '使用我的版本', value: 'mine' },
  { label: '使用他们的版本', value: 'theirs' },
  { label: '手动解决', value: 'manual' }
];
```

#### 3. 状态栏文本
```typescript
// 状态栏工具提示
this.updateStatusBarItem.tooltip = '更新/拉取';
this.commitStatusBarItem.tooltip = '提交更改';
this.historyStatusBarItem.tooltip = '查看历史记录';

// 状态显示
this.statusBarItem.text = vcsType === 'svn' ? '$(source-control) SVN' : '$(git-branch) Git';
this.branchStatusBarItem.text = `$(git-branch) ${branch}`;
this.branchStatusBarItem.tooltip = `当前分支: ${branch}`;
```

#### 4. 配置描述
```json
{
  "svn-auto-commit.enabled": {
    "description": "是否启用插件"
  },
  "svn-auto-commit.defaultVCS": {
    "description": "默认版本控制系统"
  },
  "svn-auto-commit.showStatusBar": {
    "description": "是否在状态栏显示插件状态"
  }
}
```

#### 5. 命令定义
```json
{
  "commands": [
    {
      "command": "svn-auto-commit.commit",
      "title": "提交更改",
      "category": "SVN/Git 自动提交"
    },
    {
      "command": "svn-auto-commit.update",
      "title": "更新/拉取",
      "category": "SVN/Git 自动提交"
    }
  ]
}
```

### 🔧 技术实现细节

#### 1. 命令一致性修复
- 修复了 `commandManager.ts` 中注册的命令名称与 `package.json` 中定义不一致的问题
- 统一使用 `svn-auto-commit.*` 命名规范
- 更新了状态栏命令引用

#### 2. 配置系统完善
- 添加了所有命令的定义到 `package.json`
- 更新了激活事件列表
- 确保配置项描述完整且准确

#### 3. 错误处理中文化
- 所有异常处理都使用中文错误信息
- 提供了详细的错误描述和解决建议
- 统一了错误信息的格式和风格

### 🎨 用户体验改进

#### 1. 界面友好性
- 所有用户可见的文本都使用中文
- 提供了清晰的操作指引
- 错误信息具有指导性

#### 2. 操作便捷性
- 状态栏图标提供直观的操作入口
- 快捷键支持快速操作
- 命令面板提供完整的功能访问

#### 3. 信息反馈
- 操作成功/失败都有明确的反馈
- 提供了详细的状态信息
- 支持进度提示和通知

### 📚 文档支持

#### 1. 完整的中文文档
- **用户指南.md**: 详细的功能说明和配置指南
- **开发文档.md**: 开发相关的技术文档
- **发布文档.md**: 发布和更新相关文档
- **需求规格.md**: 完整的需求规格说明

#### 2. 项目级配置支持
- **.svn-auto-commit.example.json**: 项目级配置模板
- 支持团队统一配置
- 提供了详细的配置说明

### 🚀 使用建议

#### 1. 快速开始
1. 安装插件后会自动检测项目类型
2. 使用 `Ctrl+Alt+V` 快速提交代码
3. 点击状态栏图标进行各种操作
4. 查看文档了解高级功能

#### 2. 配置建议
- 根据团队需求配置提交信息模板
- 设置合适的自动提交延迟时间
- 配置忽略模式排除不必要的文件

#### 3. 团队使用
- 使用项目级配置统一团队设置
- 制定统一的提交信息规范
- 分享配置模板给团队成员

### 📝 中文化总结

本次中文化工作已经全面完成，包括：

✅ **用户界面**: 所有用户可见的文本都已中文化  
✅ **配置系统**: 完整的中文配置描述和说明  
✅ **命令系统**: 统一的中文命令标题和分类  
✅ **错误处理**: 友好的中文错误信息和建议  
✅ **文档系统**: 完整的中文使用文档和指南  
✅ **技术修复**: 修复了命令一致性等技术问题  

插件现在提供了完全的中文用户体验，适合中文用户使用。所有功能都经过测试，确保正常工作。

## 🎯 菜单系统集成

### 📋 菜单集成概览

插件现在已经完全集成到 VSCode 的各个菜单系统中，提供便捷的图标化操作体验。

### 📋 菜单位置和功能

#### 1. **命令面板** (`Ctrl+Shift+P`)
所有插件命令都可以通过命令面板访问：

| 命令 | 图标 | 功能描述 |
|------|------|----------|
| `SVN/Git 自动提交: 提交更改` | `$(git-commit)` | 提交当前更改 |
| `SVN/Git 自动提交: 启用/禁用自动提交` | `$(sync-ignored)` | 切换自动提交状态 |
| `SVN/Git 自动提交: 更新/拉取` | `$(sync)` | 从远程更新代码 |
| `SVN/Git 自动提交: 查看历史` | `$(history)` | 查看提交历史 |
| `SVN/Git 自动提交: 显示操作菜单` | `$(menu)` | 显示快捷操作菜单 |
| `SVN/Git 自动提交: 显示分支信息` | `$(git-branch)` | 显示当前分支信息 |
| `SVN/Git 自动提交: 解决冲突` | `$(diff)` | 解决版本冲突 |
| `SVN/Git 自动提交: 打开设置` | `$(gear)` | 打开插件设置 |
| `SVN/Git 自动提交: 设置SVN认证` | `$(key)` | 设置SVN用户认证 |

#### 2. **文件资源管理器右键菜单**
在文件资源管理器中右键文件或文件夹时显示：

##### 📁 文件夹右键菜单
- `$(git-commit) 提交更改` - 提交当前文件夹的更改
- `$(sync) 更新/拉取` - 更新当前文件夹
- `$(menu) 显示操作菜单` - 显示完整操作菜单

##### 📄 文件右键菜单
- `$(git-commit) 提交更改` - 提交当前文件
- `$(sync) 更新/拉取` - 更新当前文件
- `$(history) 查看历史` - 查看文件提交历史

#### 3. **编辑器右键菜单**
在编辑器中右键时显示：

- `$(git-commit) 提交更改` - 提交当前文件
- `$(history) 查看历史` - 查看当前文件历史
- `$(diff) 解决冲突` - 解决当前文件冲突

#### 4. **编辑器标题栏**
在编辑器标题栏右侧显示图标按钮：

- `$(git-commit)` - 快速提交当前文件
- `$(sync)` - 快速更新当前文件
- `$(history)` - 查看当前文件历史

#### 5. **编辑器标题栏右键菜单**
右键点击编辑器标题栏时显示：

- `$(git-commit) 提交更改` - 提交当前文件
- `$(history) 查看历史` - 查看文件历史

#### 6. **源代码管理面板**
在 SCM (Source Control Management) 面板标题栏显示：

- `$(git-commit)` - 执行提交操作
- `$(sync)` - 执行更新/拉取操作
- `$(sync-ignored)` - 切换自动提交状态

#### 7. **视图标题栏**
在源代码管理视图中显示：

- `$(menu)` - 显示操作菜单
- `$(gear)` - 打开插件设置

### 🎨 图标说明

#### 图标含义
| 图标 | 含义 | 使用场景 |
|------|------|----------|
| `$(git-commit)` | Git 提交 | 提交相关操作 |
| `$(sync)` | 同步 | 更新/拉取操作 |
| `$(sync-ignored)` | 同步忽略 | 自动提交切换 |
| `$(history)` | 历史记录 | 查看历史操作 |
| `$(menu)` | 菜单 | 显示操作菜单 |
| `$(git-branch)` | Git 分支 | 分支相关操作 |
| `$(diff)` | 差异比较 | 冲突解决操作 |
| `$(gear)` | 设置齿轮 | 配置和设置 |
| `$(key)` | 密钥 | 认证设置 |

#### 图标颜色和状态
- **正常状态**: 默认主题颜色
- **激活状态**: 高亮显示
- **禁用状态**: 灰色显示

### 🔧 菜单条件显示

#### 智能显示逻辑
插件使用 VSCode 的 `when` 条件来智能显示菜单项：

##### 文件资源管理器
```json
"when": "explorerResourceIsFolder || !explorerResourceIsRoot"
```
- 在文件夹或非根目录文件上显示

##### 编辑器上下文
```json
"when": "editorTextFocus"
```
- 仅在编辑器获得焦点时显示

##### 源代码管理视图
```json
"when": "view == workbench.scm"
```
- 仅在源代码管理视图中显示

### 🚀 使用建议

#### 1. **快速操作**
- 使用编辑器标题栏图标进行快速操作
- 右键菜单提供上下文相关的操作

#### 2. **批量操作**
- 在文件夹上右键进行批量操作
- 使用源代码管理面板进行全局操作

#### 3. **文件级操作**
- 在单个文件上右键进行精确操作
- 编辑器内右键提供文件相关功能

#### 4. **快捷访问**
- 命令面板提供完整功能访问
- 状态栏提供常用功能快捷方式

### 📱 用户体验优化

#### 1. **一致性**
- 所有菜单使用统一的图标和命名
- 保持操作逻辑的一致性

#### 2. **可发现性**
- 图标直观易懂
- 菜单项按重要性排序

#### 3. **上下文相关**
- 根据当前环境智能显示相关功能
- 避免不相关的菜单项干扰

#### 4. **快捷操作**
- 常用功能放在易访问的位置
- 提供多种访问方式

### 🎯 功能演示

#### 典型使用场景

##### 场景1: 快速提交单个文件
1. 在编辑器中编辑文件
2. 点击编辑器标题栏的 `$(git-commit)` 图标
3. 选择要提交的文件
4. 输入提交信息并确认

##### 场景2: 批量操作文件夹
1. 在文件资源管理器中右键文件夹
2. 选择 `$(git-commit) 提交更改`
3. 选择要提交的文件
4. 完成批量提交

##### 场景3: 查看文件历史
1. 在编辑器中右键
2. 选择 `$(history) 查看历史`
3. 在输出面板查看历史记录

##### 场景4: 解决冲突
1. 在有冲突的文件上右键
2. 选择 `$(diff) 解决冲突`
3. 选择解决方式
4. 完成冲突解决

##### 场景5: 设置SVN认证
1. 在命令面板中输入 `SVN/Git 自动提交: 设置SVN认证`
2. 或点击状态栏SVN图标选择认证设置
3. 输入用户名和密码
4. 认证信息安全存储

### 🔮 未来扩展

#### 计划中的菜单功能
- **工作区级菜单**: 在工作区根目录提供全局操作
- **状态相关菜单**: 根据文件状态显示不同操作
- **团队协作菜单**: 添加团队协作相关功能
- **自定义菜单**: 允许用户自定义菜单项

### 📝 菜单系统总结

通过完整的菜单集成，插件现在提供了：

✅ **全面的菜单覆盖**: 覆盖 VSCode 的所有主要菜单位置  
✅ **直观的图标系统**: 使用标准 VSCode 图标，易于理解  
✅ **智能的显示逻辑**: 根据上下文智能显示相关功能  
✅ **一致的用户体验**: 统一的操作逻辑和视觉设计  
✅ **便捷的快捷操作**: 多种访问方式，提高操作效率  

用户现在可以通过多种方式访问插件功能，享受更加便捷和直观的版本控制体验！

## 🏗️ 技术架构

### 核心模块设计

#### 1. **扩展入口** (`extension.ts`)
- 插件激活和停用管理
- 依赖注入和服务注册
- 全局错误处理

#### 2. **命令管理器** (`commandManager.ts`)
- 统一的命令注册和处理
- 命令生命周期管理
- 命令权限控制

#### 3. **版本控制提供者**
- **SVN 提供者** (`svnProvider.ts`)
- **Git 提供者** (`gitProvider.ts`)
- **通用接口** (`vcsProvider.ts`)

#### 4. **配置管理器** (`configManager.ts`)
- 全局和项目级配置
- 配置验证和迁移
- 动态配置更新

#### 5. **状态栏管理器** (`statusBarManager.ts`)
- 状态栏UI组件管理
- 实时状态更新
- 用户交互处理

#### 6. **自动提交管理器** (`autoCommitManager.ts`)
- 文件监控和变更检测
- 自动提交调度
- 智能提交策略

#### 7. **提交模板管理器** (`commitTemplateManager.ts`)
- 提交信息模板处理
- 变量替换和格式化
- 模板验证

### 数据流架构

```
用户操作 → 命令管理器 → VCS提供者 → 外部命令 → 结果处理 → UI更新
    ↓           ↓           ↓           ↓           ↓
配置管理器 ← 状态管理 ← 错误处理 ← 日志记录 ← 通知系统
```

### 扩展点设计

#### 1. **版本控制系统扩展**
```typescript
interface VCSProvider {
  name: string;
  detect(workspacePath: string): Promise<boolean>;
  commit(files: string[], message: string): Promise<void>;
  update(): Promise<void>;
  getStatus(): Promise<FileStatus[]>;
}
```

#### 2. **提交模板扩展**
```typescript
interface CommitTemplate {
  name: string;
  generate(context: CommitContext): string;
  validate(message: string): ValidationResult;
}
```

#### 3. **钩子系统**
```typescript
interface CommitHook {
  name: string;
  preCommit?(context: CommitContext): Promise<boolean>;
  postCommit?(result: CommitResult): Promise<void>;
}
```

## 🛠️ 开发指南

### 开发环境设置

#### 1. **环境要求**
- Node.js 16.0+
- VSCode 1.73.0+
- TypeScript 4.8+
- Git 2.0+ (可选)
- SVN 1.7+ (可选)

#### 2. **项目设置**
```bash
# 克隆项目
git clone https://github.com/QINGYUAI/svn-auto-vscode.git
cd svn-auto-vscode

# 安装依赖
npm install

# 编译项目
npm run compile

# 启动调试
npm run watch
```

#### 3. **调试配置**
在 VSCode 中按 `F5` 启动调试模式，会打开新的扩展开发宿主窗口。

### 代码规范

#### 1. **TypeScript 规范**
- 使用严格模式 (`"strict": true`)
- 所有函数必须有类型注解
- 使用 ESLint 进行代码检查

#### 2. **命名规范**
- 类名使用 PascalCase
- 方法和变量使用 camelCase
- 常量使用 UPPER_SNAKE_CASE
- 文件名使用 camelCase

#### 3. **注释规范**
```typescript
/**
 * 提交文件到版本控制系统
 * @param files 要提交的文件列表
 * @param message 提交信息
 * @returns 提交结果
 */
async commitFiles(files: string[], message: string): Promise<CommitResult> {
  // 实现逻辑
}
```

### 测试指南

#### 1. **单元测试**
```bash
# 运行所有测试
npm test

# 运行特定测试
npm test -- --grep "CommandManager"

# 生成覆盖率报告
npm run test:coverage
```

#### 2. **集成测试**
```bash
# 编译测试
npm run compile-tests

# 运行集成测试
npm run test:integration
```

#### 3. **测试结构**
```
src/test/
├── suite/
│   ├── extension.test.ts      # 扩展主要功能测试
│   ├── commandManager.test.ts # 命令管理器测试
│   ├── configManager.test.ts  # 配置管理器测试
│   └── vcsProvider.test.ts    # VCS提供者测试
├── runTest.ts                 # 测试运行器
└── index.ts                   # 测试套件入口
```

### 构建和发布

#### 1. **构建流程**
```bash
# 开发构建
npm run compile

# 生产构建
npm run package

# 打包扩展
npx vsce package
```

#### 2. **发布流程**
```bash
# 发布到市场
npx vsce publish

# 发布预览版
npx vsce publish --pre-release
```

#### 3. **版本管理**
- 使用语义化版本控制 (SemVer)
- 主版本号：不兼容的API修改
- 次版本号：向下兼容的功能性新增
- 修订号：向下兼容的问题修正

## 🤝 贡献指南

### 贡献流程

#### 1. **准备工作**
1. Fork 项目到你的 GitHub 账户
2. 克隆 Fork 的仓库到本地
3. 创建新的功能分支

```bash
git checkout -b feature/your-feature-name
```

#### 2. **开发流程**
1. 编写代码和测试
2. 确保所有测试通过
3. 更新相关文档
4. 提交代码

```bash
git add .
git commit -m "feat: add your feature description"
git push origin feature/your-feature-name
```

#### 3. **提交 Pull Request**
1. 在 GitHub 上创建 Pull Request
2. 填写详细的 PR 描述
3. 等待代码审查
4. 根据反馈修改代码

### 代码审查标准

#### 1. **功能性**
- 功能是否按预期工作
- 是否有充分的测试覆盖
- 是否处理了边界情况

#### 2. **代码质量**
- 代码是否清晰易读
- 是否遵循项目规范
- 是否有适当的注释

#### 3. **性能**
- 是否有性能问题
- 是否有内存泄漏
- 是否优化了关键路径

#### 4. **兼容性**
- 是否向下兼容
- 是否支持所有目标平台
- 是否处理了版本差异

### 问题报告

#### 1. **Bug 报告**
使用以下模板报告 Bug：

```markdown
## Bug 描述
简要描述遇到的问题

## 复现步骤
1. 步骤一
2. 步骤二
3. 步骤三

## 预期行为
描述你期望的正确行为

## 实际行为
描述实际发生的行为

## 环境信息
- VSCode 版本：
- 插件版本：
- 操作系统：
- 版本控制系统：

## 附加信息
其他可能有用的信息
```

#### 2. **功能请求**
使用以下模板提交功能请求：

```markdown
## 功能描述
详细描述你希望添加的功能

## 使用场景
描述这个功能的使用场景

## 解决方案
如果有的话，描述你建议的解决方案

## 替代方案
描述你考虑过的其他解决方案

## 附加信息
其他相关信息
```

### 文档贡献

#### 1. **文档类型**
- 用户文档：使用指南、配置说明
- 开发文档：API文档、架构说明
- 示例文档：配置示例、使用案例

#### 2. **文档规范**
- 使用 Markdown 格式
- 包含适当的代码示例
- 提供清晰的步骤说明
- 使用统一的术语

#### 3. **文档更新**
- 新功能必须更新相关文档
- 修复问题时更新故障排除指南
- 定期审查和更新过时内容

### 社区参与

#### 1. **讨论参与**
- 参与 GitHub Discussions
- 回答用户问题
- 分享使用经验

#### 2. **代码贡献**
- 修复已知问题
- 实现新功能
- 改进性能和稳定性

#### 3. **测试贡献**
- 测试新版本
- 报告兼容性问题
- 提供测试用例

---

## 📞 联系方式

### 开发团队
- **主要开发者**: QINGYUAI
- **邮箱**: 2321135061@qq.com
- **GitHub**: https://github.com/QINGYUAI

### 项目链接
- **GitHub 仓库**: https://github.com/QINGYUAI/svn-auto-vscode
- **问题跟踪**: https://github.com/QINGYUAI/svn-auto-vscode/issues
- **讨论区**: https://github.com/QINGYUAI/svn-auto-vscode/discussions
- **插件市场**: https://marketplace.visualstudio.com/items?itemName=QINGYUAI.svn-git-auto-commit

---

**版本**: v0.1.1  
**更新时间**: 2025-01-13  
**文档维护**: 开发团队
