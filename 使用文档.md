# SVN/Git 自动提交插件使用文档

## 📖 目录
- [插件简介](#插件简介)
- [安装方法](#安装方法)
- [快速开始](#快速开始)
- [基本功能](#基本功能)
- [高级配置](#高级配置)
- [使用示例](#使用示例)
- [故障排除](#故障排除)
- [常见问题](#常见问题)

## 🚀 插件简介

SVN/Git 自动提交插件是一个为 VSCode 开发的版本控制自动化工具，旨在简化代码提交流程，提高开发效率。

### 主要特性
- ✅ **双版本控制系统支持**：同时支持 SVN 和 Git
- ✅ **智能自动检测**：自动识别项目使用的版本控制系统
- ✅ **上下文感知提交**：根据当前编辑器或选中文件智能提交
- ✅ **自动提交信息生成**：根据文件类型和变更内容智能生成提交信息
- ✅ **自动提交功能**：监控文件变化，自动执行提交
- ✅ **提交信息模板**：支持自定义提交信息格式
- ✅ **冲突解决辅助**：提供简单的冲突解决选项
- ✅ **状态栏集成**：在 VSCode 状态栏显示快捷操作
- ✅ **丰富的配置选项**：满足不同项目和团队需求

## 📦 安装方法

### 方法一：开发模式安装（推荐用于测试）

1. **克隆或下载项目**
   ```bash
   git clone <项目地址>
   cd svn-vscode
   ```

2. **安装依赖**
   ```bash
   npm install
   ```

3. **编译项目**
   ```bash
   npm run compile
   ```

4. **在 VSCode 中调试**
   - 在 VSCode 中打开项目文件夹
   - 按 `F5` 或使用命令面板 `Debug: Start Debugging`
   - 这会打开一个新的 VSCode 窗口来测试插件

### 方法二：打包安装

1. **打包插件**
   ```bash
   npm run package
   ```

2. **生成 VSIX 文件**
   ```bash
   npx vsce package
   ```

3. **安装 VSIX 文件**
   - 在 VSCode 中按 `Ctrl+Shift+P` (Mac: `Cmd+Shift+P`)
   - 输入 `Extensions: Install from VSIX...`
   - 选择生成的 `.vsix` 文件

## ⚡ 快速开始

### 1. 首次使用设置

安装插件后，插件会自动检测你的项目类型：

- 如果项目根目录有 `.git` 文件夹，识别为 Git 项目
- 如果项目根目录有 `.svn` 文件夹，识别为 SVN 项目
- 如果都没有，可以手动设置默认版本控制系统

### 2. 基本配置

打开 VSCode 设置 (`Ctrl+,` 或 `Cmd+,`)，搜索 `svn-auto-commit`：

```json
{
  "svn-auto-commit.enabled": true,
  "svn-auto-commit.defaultVCS": "auto",
  "svn-auto-commit.showStatusBar": true,
  "svn-auto-commit.confirmBeforeCommit": true
}
```

### 3. 状态栏说明

插件启用后，你会在 VSCode 底部状态栏看到：

| 图标 | 说明 | 点击操作 |
|------|------|----------|
| `$(source-control) SVN` 或 `$(git-branch) Git` | 当前版本控制系统 | 显示操作菜单 |
| `$(git-branch) 分支名` | 当前分支 | 显示分支信息 |
| `$(sync)` | 更新/拉取 | 执行更新操作 |
| `$(git-commit) [数字]` | 提交（显示变更文件数） | 执行提交操作 |
| `$(history)` | 历史记录 | 查看提交历史 |

## 🎯 基本功能

### 1. 提交更改

#### 方法一：快捷键
- 按 `Ctrl+Alt+V` (Mac: `Cmd+Alt+V`) - V for Version control

#### 方法二：状态栏
- 点击状态栏的 `$(git-commit)` 图标

#### 方法三：命令面板
- 按 `Ctrl+Shift+P` (Mac: `Cmd+Shift+P`)
- 输入 `SVN/Git 自动提交: 提交更改`

#### 方法四：右键菜单
- 在文件资源管理器中右键
- 选择 `提交更改`

### 2. 上下文感知提交流程

插件现在支持智能的上下文感知提交，根据不同场景自动优化提交流程：

#### 📝 编辑器上下文提交
当在编辑器中使用快捷键 `Ctrl+Alt+V` 或从编辑器右键菜单提交时：
- 🎯 **自动选择当前文件**：如果当前编辑的文件有变更，会自动预选该文件
- 🤖 **智能生成提交信息**：根据文件类型和变更内容自动生成合适的提交信息
- ⚡ **快速提交模式**：如果只有当前文件变更，可配置跳过文件选择直接提交

#### 📁 资源管理器上下文提交
当从文件资源管理器右键菜单提交时：
- 🎯 **预选右键文件**：自动预选你右键点击的文件
- 📋 **显示相关文件**：同时显示其他变更文件供选择

#### 🎛️ 传统提交流程
从命令面板或状态栏提交时，保持原有的完整选择流程：
1. **选择文件**：在弹出的文件选择器中选择要提交的文件
2. **确认提交信息**：查看或修改自动生成的提交信息
3. **执行提交**：点击确认，插件自动执行提交

### 3. 更新/拉取

- **SVN 项目**：执行 `svn update`
- **Git 项目**：执行 `git pull`

### 4. 查看历史记录

- 点击状态栏的 `$(history)` 图标
- 或使用命令面板：`SVN/Git 自动提交: 查看历史`
- 历史记录会在输出面板中显示

### 5. 冲突解决

当检测到冲突时，状态栏会显示 `$(alert)` 图标：

1. 点击主状态栏图标，选择 `解决冲突`
2. 选择冲突文件
3. 选择解决方式：
   - **使用我的版本**：保留本地修改
   - **使用他们的版本**：使用远程版本
   - **手动解决**：打开文件进行手动合并

## ⚙️ 高级配置

### 1. SVN 特定配置

```json
{
  "svn-auto-commit.svn.path": "svn",
  "svn-auto-commit.svn.username": "your_username",
  "svn-auto-commit.svn.password": "your_password",
  "svn-auto-commit.svn.autoUpdate": true,
  "svn-auto-commit.svn.addUnversioned": false,
  "svn-auto-commit.svn.ignoreExternals": true
}
```

| 配置项 | 说明 | 默认值 |
|--------|------|--------|
| `svn.path` | SVN 命令路径 | `"svn"` |
| `svn.username` | SVN 用户名 | `""` |
| `svn.password` | SVN 密码（加密存储） | `""` |
| `svn.autoUpdate` | 提交前是否自动更新 | `true` |
| `svn.addUnversioned` | 是否自动添加未版本化文件 | `false` |
| `svn.ignoreExternals` | 是否忽略外部定义 | `true` |

### 2. Git 特定配置

```json
{
  "svn-auto-commit.git.path": "git",
  "svn-auto-commit.git.username": "your_username",
  "svn-auto-commit.git.email": "your@email.com",
  "svn-auto-commit.git.autoPull": true,
  "svn-auto-commit.git.autoPush": false,
  "svn-auto-commit.git.addAll": false
}
```

| 配置项 | 说明 | 默认值 |
|--------|------|--------|
| `git.path` | Git 命令路径 | `"git"` |
| `git.username` | Git 用户名 | `""` |
| `git.email` | Git 邮箱 | `""` |
| `git.autoPull` | 提交前是否自动拉取 | `true` |
| `git.autoPush` | 提交后是否自动推送 | `false` |
| `git.addAll` | 是否自动添加所有变更 | `false` |

### 3. 自动提交配置

```json
{
  "svn-auto-commit.autoCommit.enabled": false,
  "svn-auto-commit.autoCommit.delay": 30,
  "svn-auto-commit.autoCommit.showNotification": true,
  "svn-auto-commit.autoCommit.messageTemplate": "自动提交: {fileList} - {datetime}",
  "svn-auto-commit.autoCommit.ignorePatterns": [
    "**/.git/**",
    "**/node_modules/**",
    "**/.svn/**",
    "**/*.log",
    "**/dist/**",
    "**/build/**"
  ]
}
```

| 配置项 | 说明 | 默认值 |
|--------|------|--------|
| `autoCommit.enabled` | 是否启用自动提交 | `false` |
| `autoCommit.delay` | 文件变更后的延迟时间（秒） | `30` |
| `autoCommit.showNotification` | 是否显示提交通知 | `true` |
| `autoCommit.messageTemplate` | 自动提交信息模板 | `""` |
| `autoCommit.ignorePatterns` | 忽略的文件模式 | 见上表 |

### 4. 上下文感知提交配置

```json
{
  "svn-auto-commit.contextAware.enabled": true,
  "svn-auto-commit.contextAware.autoSelectCurrentFile": true,
  "svn-auto-commit.contextAware.autoGenerateMessage": true,
  "svn-auto-commit.contextAware.skipFileSelection": false
}
```

| 配置项 | 说明 | 默认值 |
|--------|------|--------|
| `contextAware.enabled` | 是否启用上下文感知提交 | `true` |
| `contextAware.autoSelectCurrentFile` | 在编辑器中提交时是否自动选择当前文件 | `true` |
| `contextAware.autoGenerateMessage` | 是否自动生成提交信息 | `true` |
| `contextAware.skipFileSelection` | 当只有当前文件变更时是否跳过文件选择 | `false` |

### 5. 提交信息模板配置

```json
{
  "svn-auto-commit.commit.template": "更新 {fileList}",
  "svn-auto-commit.commit.username": "开发者姓名",
  "svn-auto-commit.commit.validateMessage": false,
  "svn-auto-commit.commit.minLength": 5,
  "svn-auto-commit.commit.maxLength": 100,
  "svn-auto-commit.commit.requirePrefix": false,
  "svn-auto-commit.commit.allowedPrefixes": [
    "feat", "fix", "docs", "style", "refactor", "perf", "test", "chore", "revert"
  ]
}
```

#### 模板变量

| 变量 | 说明 | 示例 |
|------|------|------|
| `{date}` | 当前日期 | `2023-09-13` |
| `{time}` | 当前时间 | `14:30:45` |
| `{datetime}` | 日期和时间 | `2023-09-13 14:30:45` |
| `{username}` | 用户名 | `张三` |
| `{fileCount}` | 变更文件数量 | `3` |
| `{fileList}` | 变更文件列表 | `index.js, style.css` |
| `{changeType}` | 变更类型（自动检测） | `修改`, `配置`, `文档`, `样式` |

#### 智能变更类型检测

插件会根据文件扩展名自动检测变更类型：

| 文件类型 | 变更类型 | 示例文件 |
|----------|----------|----------|
| 代码文件 | `修改` | `.ts`, `.js`, `.py`, `.java` |
| 配置文件 | `配置` | `.json`, `.yml`, `.xml` |
| 文档文件 | `文档` | `.md`, `.txt`, `.doc` |
| 样式文件 | `样式` | `.css`, `.scss`, `.less` |
| 混合类型 | `功能和样式` | 同时包含代码和样式文件 |

### 5. 项目级配置

在项目根目录创建 `.svn-auto-commit.json` 文件：

```json
{
  "vcs": "svn",
  "username": "project-user",
  "commitTemplate": "[{type}] {message} - {username} ({date})",
  "autoCommitEnabled": true,
  "autoCommitInterval": 60,
  "ignorePatterns": [
    "*.log",
    "node_modules/",
    "dist/",
    ".env"
  ]
}
```

## 💡 使用示例

### 示例 1：基本提交流程

1. 修改一些文件
2. 按 `Ctrl+Alt+V` (V for Version control)
3. 在文件选择器中选择要提交的文件
4. 输入提交信息：`修复登录页面样式问题`
5. 按回车确认提交

### 示例 2：使用提交信息模板

**配置模板**：
```json
{
  "svn-auto-commit.commit.template": "[修复] {message} - {username} ({date})"
}
```

**实际效果**：
```
[修复] 登录页面样式问题 - 张三 (2023-09-13)
```

### 示例 3：启用自动提交

**配置**：
```json
{
  "svn-auto-commit.autoCommit.enabled": true,
  "svn-auto-commit.autoCommit.delay": 60,
  "svn-auto-commit.autoCommit.messageTemplate": "自动提交: {fileList} ({datetime})"
}
```

**效果**：文件修改后 60 秒自动提交，提交信息如：
```
自动提交: index.js, style.css (2023-09-13 14:30:45)
```

### 示例 4：上下文感知提交

**场景**：正在编辑 `src/components/Button.tsx` 文件

1. **修改文件后按 `Ctrl+Alt+V`**
2. **插件自动检测**：
   - 当前文件：`Button.tsx`
   - 变更类型：`修改`（TypeScript 代码文件）
3. **自动生成提交信息**：`修改 Button.tsx`
4. **如果启用自动生成**：直接提交，无需手动输入

**配置**：
```json
{
  "svn-auto-commit.contextAware.enabled": true,
  "svn-auto-commit.contextAware.autoSelectCurrentFile": true,
  "svn-auto-commit.contextAware.autoGenerateMessage": true,
  "svn-auto-commit.commit.template": "{changeType} {fileList}"
}
```

### 示例 5：智能提交信息生成

**不同文件类型的自动提交信息**：

| 修改文件 | 生成的提交信息 |
|----------|----------------|
| `README.md` | `文档 README.md` |
| `package.json` | `配置 package.json` |
| `style.css` | `样式 style.css` |
| `index.js, style.css` | `功能和样式 index.js, style.css` |
| `utils.ts, helper.ts, main.ts` | `功能 utils.ts, helper.ts 等3个文件` |

### 示例 6：团队项目配置

**项目配置文件** (`.svn-auto-commit.json`)：
```json
{
  "vcs": "git",
  "contextAware": {
    "enabled": true,
    "autoSelectCurrentFile": true,
    "autoGenerateMessage": true,
    "skipFileSelection": true
  },
  "commit": {
    "template": "[{changeType}] {fileList} - {username}",
    "username": "团队开发者",
    "validateMessage": true,
    "minLength": 10
  }
}
```

## 🔧 故障排除

### 常见问题及解决方案

#### 1. 插件无法检测版本控制系统

**问题**：状态栏显示"未检测到版本控制"

**解决方案**：
- 确保项目根目录有 `.git` 或 `.svn` 文件夹
- 检查 `svn-auto-commit.autoDetect` 设置是否为 `true`
- 手动设置 `svn-auto-commit.defaultVCS` 为 `"svn"` 或 `"git"`

#### 2. SVN/Git 命令不可用

**问题**：提示"SVN命令不可用"或"Git命令不可用"

**解决方案**：
- 确保系统已安装 SVN 或 Git
- 检查命令是否在 PATH 环境变量中
- 设置正确的命令路径：
  ```json
  {
    "svn-auto-commit.svn.path": "/usr/local/bin/svn",
    "svn-auto-commit.git.path": "/usr/local/bin/git"
  }
  ```

#### 3. 提交失败

**问题**：提交时出现错误

**解决方案**：
- 检查网络连接
- 确认用户名和密码正确
- 检查是否有文件冲突需要解决
- 查看 VSCode 输出面板的错误信息

#### 4. 自动提交不工作

**问题**：启用自动提交但没有自动执行

**解决方案**：
- 确认 `autoCommit.enabled` 设置为 `true`
- 检查 `autoCommit.ignorePatterns` 是否排除了要监控的文件
- 确认延迟时间设置合理（不要太短）

#### 5. 状态栏不显示

**问题**：看不到插件的状态栏图标

**解决方案**：
- 检查 `showStatusBar` 设置是否为 `true`
- 重启 VSCode
- 确认插件已正确安装和启用

## ❓ 常见问题

### Q1: 插件支持哪些版本控制系统？
A1: 目前支持 SVN 和 Git 两种主流版本控制系统，可以自动检测或手动设置。

### Q2: 可以同时在一个项目中使用 SVN 和 Git 吗？
A2: 插件会优先检测 Git，如果同时存在两种版本控制系统，建议手动设置 `defaultVCS`。

### Q3: 自动提交会不会造成垃圾提交？
A3: 插件提供了延迟机制和忽略模式，可以避免频繁的无意义提交。建议合理配置延迟时间和忽略模式。

### Q4: 提交信息模板支持哪些变量？
A4: 支持日期、时间、用户名、文件列表等多种变量，详见[模板变量](#模板变量)部分。

### Q5: 如何在团队中统一配置？
A5: 可以在项目根目录创建 `.svn-auto-commit.json` 文件，团队成员的项目级配置会覆盖个人全局配置。

### Q6: 插件会存储密码吗？安全吗？
A6: 插件使用系统的 keytar 库安全存储凭证，密码会加密保存在系统凭证管理器中。

### Q7: 如何禁用某些文件的自动提交？
A7: 在 `autoCommit.ignorePatterns` 中添加文件模式，如 `"**/*.log"` 忽略所有日志文件。

### Q8: 插件支持多工作区吗？
A8: 目前主要支持单工作区，多工作区环境下会使用第一个工作区的配置。

---

## 📞 技术支持

如果遇到问题或有功能建议，请：

1. 查看本文档的故障排除部分
2. 检查 VSCode 输出面板的错误信息
3. 提交 Issue 到项目仓库

---

**版本**: v0.1.0  
**更新时间**: 2023-09-13  
**兼容性**: VSCode 1.60.0+
